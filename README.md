# us-banking-regulatory-dataset

This repository provides a Python pipeline for constructing a bank-level dataset using publicly available U.S. regulatory data.
It combines FFIEC CDR Call Reports, NIC institutional data, and optionally WRDS–Compustat identifiers.
The pipeline merges, cleans, and enriches these data sources into a consistent panel suitable for empirical research on U.S. banking.
It also includes functionality to link each institution to its publicly traded holding company by adding the relevant stock ticker, enabling integration with market and financial data.

With the resulting dataset, users can:

* Reconstruct banks’ balance sheets and income statements for each quarter since 2001.
* Track the composition of assets and liabilities, including securities by type and maturity.
* Analyze exposure to Treasuries, mortgage-backed securities, and deposits across institutions.
* Compute regulatory ratios such as capital-to-assets or loan-to-deposit ratios.
* Link regulatory filings to market data (via WRDS or Bloomberg) to study equity performance, risk sensitivity, or valuation measures.
---

## Main Steps

### Step 1. Download and organize the raw data:

Before running the code, download all data following the instructions in the folder structure below.  
Each dataset must be placed in its corresponding folder under `data/raw/`.  
All file and folder names should match exactly as shown.

### Step 2. Run the pipeline:

Once the data are in place, execute:
```
>>>python src/pipeline.py data
```

Folder Structure and User Setup:
```
us-banking-regulatory-dataset/

├── src/
│   ├── add_external_information.py     Adds NIC and WRDS attributes such as charter type, parent ID, and ticker.  
│   ├── aux_functions.py                Helper functions for crosswalks, plotting, and variable extraction.  
│   ├── call_reports_cleaner.py         Cleans and merges call report variables.  
│   ├── ingest_raw_ffiec_cdr.py         Reads and merges raw FFIEC schedule text files.  
│   ├── merge_cr_dates_fast.py          Efficiently merges quarterly CSV files into a single dataset.  
│   ├── mappings.py                     Defines the variable mappings between MDRM codes and economic concepts.  
│   ├── pipeline.py                     Main orchestration script for running the entire workflow.  

├── data/
│   ├── raw/
│   │   ├── bloomberg/
│   │   │   User action (optional)  
│   │   │   Store Bloomberg market data here, such as yields, CDS spreads, or index series.  
│   │   │   Example files:  
│   │   │       USGG10YR Index.csv  
│   │   │       CBAC1U5 Curncy.csv  
│   │   │  
│   │   │
│   │   ├── ffiec/
│   │   │   └── extracted/
│   │   │       ├── cdr/
│   │   │       │   User action (required)  
│   │   │       │   Download the FFIEC CDR Call Report bulk files from:  
│   │   │       │       https://cdr.ffiec.gov/public/pws/downloadbulkdata.aspx  
│   │   │       │   Select “Call Reports -> Single Period.”  
│   │   │       │   Download all quarters of interest (for example, 2001Q1–2024Q4).  
│   │   │       │   Unzip each period into a folder named exactly as:  
│   │   │       │       FFIEC CDR Call Bulk All Schedules 03312001/  
│   │   │       │       FFIEC CDR Call Bulk All Schedules 06302001/  
│   │   │       │   The pipeline will automatically process all folders inside `/cdr/`.  
│   │   │       │
│   │   │       └── nic/
│   │   │           User action (required)  
│   │   │           Download the National Information Center (NIC) datasets from:  
│   │   │               https://www.ffiec.gov/npw/FinancialReport/DataDownload  
│   │   │           Scroll to CSV Download and dowload the following files here:  
│   │   │               CSV_ATTRIBUTES_ACTIVE.CSV  
│   │   │               CSV_ATTRIBUTES_CLOSED.CSV  
│   │   │               CSV_TRANSFORMATIONS.CSV  
│   │   │               CSV_RELATIONSHIPS.CSV  
│   │   │           These files contain bank attributes, mergers, and parent–subsidiary linkages.  
│   │   │
│   │   ├── fred/
│   │   │   User action (optional)  
│   │   │   Store macroeconomic or yield-curve data obtained from FRED, such as ACM term premia or the federal funds rate.  
│   │   │
│   │   └── wrds_compustat/
│   │       User action (required)  
│   │       Combine WRDS and NY Fed crosswalk data to link banks to market identifiers.  
│   │       Step 1: Download the file and save it as `permco_idrssd_xwalk.csv` from:  
│   │           https://www.newyorkfed.org/research/banking_research/datasets.html  
│   │       Step 2: Query WRDS for the corresponding firm-level data and save it as `wrds_data.csv`.  
│   │           Include variables such as `permco`, `permno`, `tic`, and `datacqtr`.  
│   │           (WRDS data is proprietary and cannot be publicly redistributed).
│   │
│   ├── intermediate/
│   │   Generated by the pipeline  
│   │   ├── ffiec_cdr_all_dates/          Contains per-date merged call reports (Step 1 output).  
│   │   └── ffiec_cdr_all_dates_merged/   Contains the single merged dataset (Step 2 output).  
│   │
│   └── clean/
│       Generated by the pipeline  
│       └── final_call_reports_dataset.csv   Final dataset containing all constructed variables and attributes.  
│  
└── README.md
```
